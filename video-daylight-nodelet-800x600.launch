<launch>
  <!-- <arg name="DEVICE" default="/dev/video0"/> -->
  <arg name="sync_sink" default="true" />                    <!-- Synchronize the app sink -->
  <arg name="width" default="800" />                        <!-- Image Width -->
  <arg name="height" default="600" />                        <!-- Image Height -->
  <arg name="fps" default="20" />  
  <arg name="respawn" default="false" />
  <arg name="left" default="left" />
  <arg name="right" default="right" />
  <arg name="approximate_sync" default="true" />                          <!-- Desired framerate -->
  <arg     if="$(arg respawn)" name="bond" value="" />
  <arg unless="$(arg respawn)" name="bond" value="--no-bond" />

  <!-- Make arguments available to parameter server -->
  <param name="image_width" type="int" value="$(arg width)" />
  <param name="image_height" type="int" value="$(arg height)" />
  <param name="target_fps" type="int" value="$(arg fps)" />
  

  <group ns="stereo">

    <node pkg="nodelet" type="nodelet" name="standalone_nodelet" args="manager" output="screen"/>  

    <node pkg="nodelet" type="nodelet" name="GSCamNodeletLeft" args="load gscam/GSCamNodelet standalone_nodelet respawn:=true" output="screen">
      <param name="camera_name" value="left"/>
      <param name="camera_info_url" value="package://jetson_csi_cam/left_800x600.yaml"/>
      <param name="gscam_config" value="nvarguscamerasrc sensor-id=1 aelock=true awblock=true ! video/x-raw(memory:NVMM), width=(int)$(arg width), height=(int)$(arg height), format=(string)NV12,framerate=(fraction)$(arg fps)/1 ! nvvidconv flip-method=2  ! video/x-raw, format=(string)BGRx ! videoconvert ! video/x-raw, format=(string)BGR" />
      <param name="frame_id" value="left_link"/>
      <param name="sync_sink" value="true"/>
      <param name="left/image_width" type="int" value="$(arg width)" />
      <param name="left/image_height" type="int" value="$(arg height)" />
      <param name="left/target_fps" type="int" value="$(arg fps)" />
      <remap from="camera/image_raw" to="left/image_raw" />
      <remap from="camera/camera_info" to="left/camera_info" />
      <!--<remap from="/set_camera_info" to="left/set_camera_info" />-->
    </node>
   <node pkg="tf" type="static_transform_publisher" name="fcu_to_Left_link" args="0.08505 0.0265 -0.0562 -0.5958106 0.5966497 -0.3801439 0.3801439 fcu left_link 10" />            

    <node pkg="nodelet" type="nodelet" name="GSCamNodeletRight" args="standalone gscam/GSCamNodelet" output="screen">
      <param name="camera_name" value="right"/>
      <param name="camera_info_url" value="package://jetson_csi_cam/right_800x600.yaml"/>
      <param name="gscam_config" value="nvarguscamerasrc sensor-id=0 aelock=true awblock=true ! video/x-raw(memory:NVMM), width=(int)$(arg width), height=(int)$(arg height), format=(string)NV12,framerate=(fraction)$(arg fps)/1 ! nvvidconv flip-method=2  ! video/x-raw, format=(string)BGRx ! videoconvert ! video/x-raw, format=(string)BGR" />
      <param name="frame_id" value="right_link"/>
      <param name="sync_sink" value="true"/>
      <param name="right/image_width" type="int" value="$(arg width)" />
      <param name="right/image_height" type="int" value="$(arg height)" />
      <param name="right/target_fps" type="int" value="$(arg fps)" />
      <remap from="camera/image_raw" to="right/image_raw" />
      <remap from="camera/camera_info" to="right/camera_info" />
      <!--<remap from="/set_camera_info" to="right/set_camera_info" />-->
    </node>
   <node pkg="tf" type="static_transform_publisher" name="fcu_to_Right_link" args="0.08505 -0.0265 -0.0562 -0.5958106 0.5966497 -0.3801439 0.3801439 fcu right_link 10"/>

    <!--<node pkg="nodelet" type="nodelet" name="ImageViewNodeletLeft"
      args="load image_view/image image:=/stereo/right/image_raw standalone_nodelet"
	    respawn="false"  output="screen" >
    </node>
    <node pkg="nodelet" type="nodelet" name="ImageViewNodeletRight"
      args="standalone image_view/image image:=/stereo/left/image_raw"
	    respawn="false"  output="screen" >
    </node>

    <include file="$(find image_proc)/launch/image_proc.launch"
	   ns="left">
      <arg name="manager" value="standalone_nodelet" />
      <arg name="respawn" value="false" />
    </include>

  <! Basic processing for right camera  
    <include file="$(find image_proc)/launch/image_proc.launch"
	   ns="right">
      <arg name="manager" value="standalone_nodelet" />
      <arg name="respawn" value="false" />
    </include>

    <node pkg="nodelet" type="nodelet" name="disparity"
        args="load gpu_stereo_image_proc/libsgm_disparity standalone_nodelet"
	      respawn="false"  output="screen">
        <param name="approximate_sync" value="true" />
    </node>-->
    <node pkg="nodelet" type="nodelet" name="Image2RTSPNodelet" args="load image2rtsp/Image2RTSPNodelet standalone_nodelet --no-bond" output="screen">
    <!-- Read the stream setup file -->
        <rosparam command="load" file="$(find ros_rtsp)/config/stream_setup.yaml" />
    </node>
    <!--<include file="$(find gpu_stereo_image_proc)/launch/libsgm_stereo_image_proc.launch">
        <arg name="manager" value="/stereo/standalone_nodelet"/>
    </include>-->
    
   
  </group>
  
  
  
  

</launch>
